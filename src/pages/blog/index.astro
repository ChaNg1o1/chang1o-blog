---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title={`${SITE_TITLE} - 文章列表`} description={SITE_DESCRIPTION} />
	</head>
	<body class="min-h-screen flex flex-col bg-white dark:bg-black text-black dark:text-white">
		<Header />
		<main class="flex-1 max-w-5xl mx-auto px-5 py-16 w-full">
			<section>
				<h1 class="text-3xl font-bold mb-8 pb-2 border-b border-neutral-200 dark:border-neutral-800">所有文章</h1>
				<ul class="grid gap-5">
					{
						posts.map((post) => (
							<li class="border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-black hover:border-black dark:hover:border-white transition-colors">
								<a href={`/blog/${post.id}/`} class="block p-6">
									<div class="flex flex-col sm:flex-row sm:items-start gap-4">
										<div class="flex-shrink-0 text-center border border-neutral-200 dark:border-neutral-800 p-3 min-w-[80px]">
											<div class="text-2xl font-bold text-black dark:text-white">
												{post.data.pubDate.getDate()}
											</div>
											<div class="text-xs text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
												{post.data.pubDate.toLocaleDateString('zh-CN', { month: 'short' })}
											</div>
										</div>
										<div class="flex-1">
											<h2 class="text-lg font-semibold text-black dark:text-white mb-2 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors">
												{post.data.title}
											</h2>
											<p class="text-neutral-600 dark:text-neutral-400 mb-3 text-sm leading-relaxed">
												{post.data.description}
											</p>
											<div class="flex flex-wrap items-center gap-3 text-xs text-neutral-500 dark:text-neutral-400">
												<span>
													{post.data.pubDate.toLocaleDateString('zh-CN', {
														year: 'numeric',
														month: 'long',
														day: 'numeric',
													})}
												</span>
												{post.data.tags && (
													<div class="flex gap-2">
														{post.data.tags.slice(0, 3).map((tag) => (
															<span class="px-2 py-0.5 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 text-xs">
																{tag}
															</span>
														))}
													</div>
												)}
											</div>
										</div>
									</div>
								</a>
							</li>
						))
					}
				</ul>

				{posts.length === 0 && (
					<p class="text-center text-neutral-500 dark:text-neutral-400 py-12 border border-dashed border-neutral-300 dark:border-neutral-700">暂无文章</p>
				)}
			</section>
		</main>
		<Footer />
	</body>
</html>
